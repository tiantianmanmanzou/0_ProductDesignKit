# 通用页面标准化改造指南

## 核心原则

1. **组件复用优先**：优先使用已有的通用组件（如 `TablePage`），减少重复代码
2. **统一交互模式**：保持一致的用户体验，包括布局、操作流程和反馈方式
3. **清晰的数据流**：维护单向数据流，避免状态混乱
4. **保留业务特性**：在标准化过程中保留特定业务逻辑和特殊需求
5. **数据持久化**：采用浏览器缓存localStorage进行数据持久化，保证页面刷新后用户体验连贯

## 标准化改造步骤

### 1. 页面结构标准化

- 遵循统一容器结构：外层容器 → 标题区 → 内容区
- 使用一致的 CSS 类名命名规范
- 确保响应式布局和组件间距一致

### 2. 表格功能标准化

- 使用通用 `TablePage` 组件替代独立实现的表格+分页+搜索组合
- 配置项对应关系：
  ```
  表格列定义 → tableColumns
  操作按钮 → actionButtons
  搜索字段 → searchFields 
  搜索表单 → searchForm
  分页配置 → pagination 相关属性
  ```
- 使用插槽机制自定义列渲染，尤其是状态展示和操作列
- **操作栏必须使用template中的operations插槽**，确保操作按钮风格统一且便于维护

### 3. 搜索栏功能标准化

- **搜索功能必须正确实现并确保可用**，这是用户交互的核心环节
- 搜索字段配置必须完整且与后端接口一致：
  ```
  字段名称 → prop (必须与接口参数名一致)
  显示标签 → label
  组件类型 → type (text/select/date/datetime等)
  选项数据 → options (适用于select类型)
  ```
- 搜索事件处理必须正确实现：
  ```javascript
  // 搜索事件正确处理
  handleSearch(params) {
    this.searchParams = params; // 存储搜索参数
    this.pagination.current = 1; // 重置页码
    this.fetchData(); // 重新加载数据
  }
  ```
- 搜索条件重置后必须清空所有条件并重新加载数据
- 所有搜索字段必须设置正确的占位符和提示信息
- 确保特殊搜索字段（如日期范围、级联选择等）的正确配置与数据处理

### 4. 弹窗与表单标准化

- 使用组件内置的详情功能取代自定义弹窗
- 根据操作类型（新增/编辑/查看）动态配置表单字段和校验规则
- 保持表单字段配置与业务模型一致性
- 特殊业务操作可保留独立弹窗
- **所有弹窗必须使用通用组件中定义的弹窗样式**，包括标题栏、内容区、按钮区的布局与样式，保持全局统一

### 5. 数据处理标准化

- 统一数据加载流程：初始化 → 查询条件变化 → 分页变化
- 搜索重置时清空条件并重置分页
- 分页组件与数据加载保持同步
- **数据持久化策略**：必须合理使用localStorage进行用户操作状态和查询条件的持久化，确保页面刷新后能够恢复之前的操作状态

### 6. 事件处理标准化

- 表格行操作函数命名一致：`handleXxx`（如 `handleEdit`、`handleDelete`）
- 表单提交逻辑一致：验证 → 提交 → 反馈 → 刷新
- 批量操作前进行选择验证
- 危险操作增加确认机制

### 7. 状态展示标准化

- 使用一致的状态码映射和视觉反馈（如标签颜色）
- 数据加载状态明确展示
- 操作成功/失败反馈统一

## 常见问题与解决方案

1. **重复操作栏**：严格禁止在 `tableColumns` 中手动添加操作列，必须使用 `operations` 插槽实现操作栏
2. **搜索无反应**：**必须确保搜索栏功能正常使用**，包括正确绑定搜索字段、处理搜索事件、传递搜索条件并重置分页，搜索后应立即刷新数据
3. **详情表单字段错误**：检查 `computedDetailFields` 与数据模型字段对应关系
4. **表单提交后数据未更新**：确保提交后调用刷新方法并关闭弹窗
5. **搜索字段与接口参数不匹配**：确保搜索字段的prop属性与后端接口参数完全一致，避免因命名不一致导致搜索无效

## 迁移检查清单

- [ ] 容器结构和样式类名已统一
- [ ] 所有表格列配置已标准化（特别是 `slotName` 与插槽名称对应）
- [ ] 详情功能已替代自定义弹窗
- [ ] 搜索、分页与数据加载逻辑已协调
- [ ] 状态展示与交互反馈已统一
- [ ] 特殊业务逻辑已保留并适配新结构
- [ ] 操作栏已使用template中的operations插槽实现
- [ ] 所有弹窗已使用通用组件中的弹窗样式
- [ ] 已实现基于localStorage的数据持久化
- [ ] 搜索栏功能已完整实现并测试通过
  - [ ] 搜索字段prop与接口参数一致
  - [ ] 搜索事件正确处理并刷新数据
  - [ ] 重置功能正确清空条件并刷新数据

